class SemiautomaticLandmarks {
    /**
     *
     * @param {array} routinesDescription Have all json data informing all routines
     * @param {TracingController} tracingController
     * @param {LandmarksController} landmarksController
     */
    constructor(routinesDescription, tracingController, landmarksController) {
        this.routinesDescription = routinesDescription;
        this.tracingController = tracingController;
        this.landmarksController = landmarksController;
        const symbolTable = {};
        const helpVariables = { accessed_curves: [], landmarkName: '' };
        this.symbolTable = symbolTable;
        this.helpVariables = helpVariables;
        const getParamValue = function (parameter) {
            return symbolTable[parameter] != null
                ? symbolTable[parameter]
                : parameter;
        };
        this.preFunctions = {
            load_curve: function (firstParam, secondParam, resultName) {
                const loadedCurves = [tracingController.getCurve(firstParam)];
                if (secondParam != null) {
                    loadedCurves.push(tracingController.getCurve(secondParam));
                    symbolTable[resultName + '_1'] = loadedCurves[0];
                    symbolTable[resultName + '_2'] = loadedCurves[1];
                }
                else {
                    symbolTable[resultName] = loadedCurves[0];
                }
                return loadedCurves;
            },
            access_point: function (firstParam, secondParam, resultName) {
                const accessed = { x: 0, y: 0 };
                let counter = 0;
                for (let index = 0; index < (symbolTable[secondParam]?.length ?? 0); index++) {
                    const element = symbolTable[secondParam] != null
                        ? symbolTable[secondParam][index] ?? ''
                        : '';
                    for (let subindex = 1; subindex < (element?.length ?? 0); subindex += 2) {
                        counter++;
                        if (counter == firstParam) {
                            accessed.x = element[subindex - 1];
                            accessed.y = element[subindex];
                        }
                    }
                }
                symbolTable[resultName] = accessed;
                return accessed;
            },
            point_to_var: function (firstParam, secondParam, resultName) {
                const toVar = symbolTable[firstParam];
                symbolTable[resultName['x']] = toVar.x;
                symbolTable[resultName['y']] = toVar.y;
            },
            add: function (firstParam, secondParam, resultName) {
                const value_1 = getParamValue(firstParam);
                const value_2 = getParamValue(secondParam);
                symbolTable[resultName] = value_1 + value_2;
                return symbolTable[resultName];
            },
            sub: function (firstParam, secondParam, resultName) {
                const value_1 = parseFloat(getParamValue(firstParam));
                const value_2 = parseFloat(getParamValue(secondParam));
                symbolTable[resultName] = value_1 - value_2;
                return symbolTable[resultName];
            },
            div: function (firstParam, secondParam, resultName) {
                const value_1 = parseFloat(getParamValue(firstParam));
                const value_2 = parseFloat(getParamValue(secondParam));
                symbolTable[resultName] = value_1 / value_2;
                return symbolTable[resultName];
            },
            mul: function (firstParam, secondParam, resultName) {
                const value_1 = parseFloat(getParamValue(firstParam));
                const value_2 = parseFloat(getParamValue(secondParam));
                symbolTable[resultName] = value_1 * value_2;
                return symbolTable[resultName];
            },
            mod: function (firstParam, secondParam, resultName) {
                const value_1 = parseFloat(getParamValue(firstParam));
                const value_2 = parseFloat(getParamValue(secondParam));
                symbolTable[resultName] = value_1 % value_2;
                return symbolTable[resultName];
            },
            average: function (firstParam, secondParam, resultName) {
                let average = 0;
                const total = firstParam.length;
                for (let index = 0; index < firstParam.length; index++) {
                    average += firstParam[index];
                }
                symbolTable[resultName] = average / total;
                return symbolTable[resultName];
            },
            return: function (firstParam, secondParam, resultName) {
                const result = {
                    x: parseFloat(symbolTable[firstParam]),
                    y: parseFloat(symbolTable[secondParam]),
                };
                landmarksController.setLandmark(helpVariables.landmarkName, result);
                landmarksController.redrawLandmarks();
                return result;
            },
        };
    }
    generateButtonEvent() {
        const self = this;
        const semiautomaticButton = document.getElementById('semiautomatic_button');
        if (semiautomaticButton) {
            semiautomaticButton.onclick = function () {
                self.start.call(self);
            };
        }
    }
    /**
     * Start all routines
     */
    start() {
        for (let index = 0; index < this.routinesDescription.length; index++) {
            const currentRoutine = this.routinesDescription[index];
            this.helpVariables.landmarkName = currentRoutine.landmark;
            this.helpVariables.accessed_curves = currentRoutine.accessed_curves;
            for (let position = 0; position < currentRoutine.routines.length; position++) {
                const element = currentRoutine.routines[position];
                this.preFunctions[element[0]](element[1], element[2], element[3]);
            }
        }
        return true;
    }
}
export default SemiautomaticLandmarks;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5pdC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2NlcGhhbG9tZXRyaWMtY2FudmFzL3NyYy9saWIvZG9tYWluL2ZlYXR1cmVzL3NlbWlhdXRvbWF0aWNfbGFuZG1hcmsvaW5pdC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFRQSxNQUFNLHNCQUFzQjtJQVF4Qjs7Ozs7T0FLRztJQUNILFlBQ0ksbUJBQTBDLEVBQzFDLGlCQUFvQyxFQUNwQyxtQkFBd0M7UUFFeEMsSUFBSSxDQUFDLG1CQUFtQixHQUFHLG1CQUFtQixDQUFDO1FBQy9DLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQztRQUMzQyxJQUFJLENBQUMsbUJBQW1CLEdBQUcsbUJBQW1CLENBQUM7UUFDL0MsTUFBTSxXQUFXLEdBQWlCLEVBQUUsQ0FBQztRQUNyQyxNQUFNLGFBQWEsR0FBRyxFQUFFLGVBQWUsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLEVBQUUsRUFBRSxDQUFDO1FBQ2hFLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQy9CLElBQUksQ0FBQyxhQUFhLEdBQUcsYUFBYSxDQUFDO1FBQ25DLE1BQU0sYUFBYSxHQUFHLFVBQVUsU0FBaUI7WUFDN0MsT0FBTyxXQUFXLENBQUMsU0FBUyxDQUFDLElBQUksSUFBSTtnQkFDakMsQ0FBQyxDQUFFLFdBQVcsQ0FBQyxTQUFTLENBQVk7Z0JBQ3BDLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFDcEIsQ0FBQyxDQUFDO1FBQ0YsSUFBSSxDQUFDLFlBQVksR0FBRztZQUNoQixVQUFVLEVBQUUsVUFDUixVQUE4QixFQUM5QixXQUFzQyxFQUN0QyxVQUFrQjtnQkFFbEIsTUFBTSxZQUFZLEdBQUcsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQztnQkFDOUQsSUFBSSxXQUFXLElBQUksSUFBSSxFQUFFO29CQUNyQixZQUFZ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QUNILEtBQUs7UUFDRCxLQUFLLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRSxLQUFLLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsRUFBRTtZQUNsRSxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDdkQsSUFBSSxDQUFDLGFBQWEsQ0FBQyxZQUFZLEdBQUcsY0FBYyxDQUFDLFFBQVEsQ0FBQztZQUMxRCxJQUFJLENBQUMsYUFBYSxDQUFDLGVBQWUsR0FBRyxjQUFjLENBQUMsZUFBZSxDQUFDO1lBQ3BFLEtBQ0ksSUFBSSxRQUFRLEdBQUcsQ0FBQyxFQUNoQixRQUFRLEdBQUcsY0FBYyxDQUFDLFFBQVEsQ0FBQyxNQUFNLEVBQ3pDLFFBQVEsRUFBRSxFQUNaO2dCQUNFLE1BQU0sT0FBTyxHQUFHLGNBQWMsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLENBQUM7Z0JBQ2xELElBQUksQ0FBQyxZQUFZLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQ3pCLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFDVixPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQ1YsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUNiLENBQUM7YUFDTDtTQUNKO1FBQ0QsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztDQUNKO0FBRUQsZUFBZSxzQkFBc0IsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGRlZmF1bHQgYXMgTGFuZG1hcmtzQ29udHJvbGxlciB9IGZyb20gJy4uLy4uL2NvbnRyb2xsZXJzL3N1YmNvbnRyb2xsZXJzL2xhbmRtYXJrc0NvbnRyb2xsZXInO1xyXG5pbXBvcnQgeyBkZWZhdWx0IGFzIFRyYWNpbmdDb250cm9sbGVyIH0gZnJvbSAnLi4vLi4vY29udHJvbGxlcnMvc3ViY29udHJvbGxlcnMvdHJhY2luZ0NvbnRyb2xsZXInO1xyXG5pbXBvcnQge1xyXG4gICAgSVJvdXRpbmVIZWxwVmFyLFxyXG4gICAgSVJvdXRpbmVzU2VtaWF1dG9tYXRpYyxcclxufSBmcm9tICcuLi8uLi91dGlsL2ludGVyZmFjZXMvaW50ZXJmYWNlcy5qcyc7XHJcbmltcG9ydCB7IElSb3V0aW5lRGVzY3JpcHRpb24sIElTeW1ib2xUYWJsZSB9IGZyb20gJy4vaW50ZXJmYWNlcyc7XHJcblxyXG5jbGFzcyBTZW1pYXV0b21hdGljTGFuZG1hcmtzIHtcclxuICAgIHB1YmxpYyByb3V0aW5lc0Rlc2NyaXB0aW9uOiBJUm91dGluZXNTZW1pYXV0b21hdGljW107XHJcbiAgICBwdWJsaWMgdHJhY2luZ0NvbnRyb2xsZXI6IFRyYWNpbmdDb250cm9sbGVyO1xyXG4gICAgcHVibGljIGxhbmRtYXJrc0NvbnRyb2xsZXI6IExhbmRtYXJrc0NvbnRyb2xsZXI7XHJcbiAgICBwdWJsaWMgc3ltYm9sVGFibGU6IElTeW1ib2xUYWJsZTtcclxuICAgIHB1YmxpYyBoZWxwVmFyaWFibGVzOiBJUm91dGluZUhlbHBWYXI7XHJcbiAgICBwdWJsaWMgcHJlRnVuY3Rpb25zOiB7IFtrZXk6IHN0cmluZ106IGFueSB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqIEBwYXJhbSB7YXJyYXl9IHJvdXRpbmVzRGVzY3JpcHRpb24gSGF2ZSBhbGwganNvbiBkYXRhIGluZm9ybWluZyBhbGwgcm91dGluZXNcclxuICAgICAqIEBwYXJhbSB7VHJhY2luZ0NvbnRyb2xsZXJ9IHRyYWNpbmdDb250cm9sbGVyXHJcbiAgICAgKiBAcGFyYW0ge0xhbmRtYXJrc0NvbnRyb2xsZXJ9IGxhbmRtYXJrc0NvbnRyb2xsZXJcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcm91dGluZXNEZXNjcmlwdGlvbjogSVJvdXRpbmVEZXNjcmlwdGlvbltdLFxyXG4gICAgICAgIHRyYWNpbmdDb250cm9sbGVyOiBUcmFjaW5nQ29udHJvbGxlcixcclxuICAgICAgICBsYW5kbWFya3NDb250cm9sbGVyOiBMYW5kbWFya3NDb250cm9sbGVyXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLnJvdXRpbmVzRGVzY3JpcHRpb24gPSByb3V0aW5lc0Rlc2NyaXB0aW9uO1xyXG4gICAgICAgIHRoaXMudHJhY2luZ0NvbnRyb2xsZXIgPSB0cmFjaW5nQ29udHJvbGxlcjtcclxuICAgICAgICB0aGlzLmxhbmRtYXJrc0NvbnRyb2xsZXIgPSBsYW5kbWFya3NDb250cm9sbGVyO1xyXG4gICAgICAgIGNvbnN0IHN5bWJvbFRhYmxlOiBJU3ltYm9sVGFibGUgPSB7fTtcclxuICAgICAgICBjb25zdCBoZWxwVmFyaWFibGVzID0geyBhY2Nlc3NlZF9jdXJ2ZXM6IFtdLCBsYW5kbWFya05hbWU6ICcnIH07XHJcbiAgICAgICAgdGhpcy5zeW1ib2xUYWJsZSA9IHN5bWJvbFRhYmxlO1xyXG4gICAgICAgIHRoaXMuaGVscFZhcmlhYmxlcyA9IGhlbHBWYXJpYWJsZXM7XHJcbiAgICAgICAgY29uc3QgZ2V0UGFyYW1WYWx1ZSA9IGZ1bmN0aW9uIChwYXJhbWV0ZXI6IHN0cmluZyk6IHN0cmluZyB7XHJcbiAgICAgICAgICAgIHJldHVybiBzeW1ib2xUYWJsZVtwYXJhbWV0ZXJdICE9IG51bGxcclxuICAgICAgICAgICAgICAgID8gKHN5bWJvbFRhYmxlW3BhcmFtZXRlcl0gYXMgc3RyaW5nKVxyXG4gICAgICAgICAgICAgICAgOiBwYXJhbWV0ZXI7XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnByZUZ1bmN0aW9ucyA9IHtcclxuICAgICAgICAgICAgbG9hZF9jdXJ2ZTogZnVuY3Rpb24gKFxyXG4gICAgICAgICAgICAgICAgZmlyc3RQYXJhbTogc3RyaW5nIHwgdW5kZWZpbmVkLFxyXG4gICAgICAgICAgICAgICAgc2Vjb25kUGFyYW06IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsXHJcbiAgICAgICAgICAgICAgICByZXN1bHROYW1lOiBzdHJpbmdcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBsb2FkZWRDdXJ2ZXMgPSBbdHJhY2luZ0NvbnRyb2xsZXIuZ2V0Q3VydmUoZmlyc3RQYXJhbSldO1xyXG4gICAgICAgICAgICAgICAgaWYgKHNlY29uZFBhcmFtICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2FkZWRDdXJ2ZXMucHVzaCh0cmFjaW5nQ29udHJvbGxlci5nZXRDdXJ2ZShzZWNvbmRQYXJhbSkpO1xyXG4gICAgICAgICAgICAgICAgICAgIHN5bWJvbFRhYmxlW3Jlc3VsdE5hbWUgKyAnXzEnXSA9IGxvYWRlZEN1cnZlc1swXTtcclxuICAgICAgICAgICAgICAgICAgICBzeW1ib2xUYWJsZVtyZXN1bHROYW1lICsgJ18yJ10gPSBsb2FkZWRDdXJ2ZXNbMV07XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHN5bWJvbFRhYmxlW3Jlc3VsdE5hbWVdID0gbG9hZGVkQ3VydmVzWzBdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRlZEN1cnZlcztcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYWNjZXNzX3BvaW50OiBmdW5jdGlvbiAoXHJcbiAgICAgICAgICAgICAgICBmaXJzdFBhcmFtOiBudW1iZXIsXHJcbiAgICAgICAgICAgICAgICBzZWNvbmRQYXJhbTogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgcmVzdWx0TmFtZTogc3RyaW5nIHwgbnVtYmVyXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYWNjZXNzZWQgPSB7IHg6IDAsIHk6IDAgfTtcclxuICAgICAgICAgICAgICAgIGxldCBjb3VudGVyID0gMDtcclxuICAgICAgICAgICAgICAgIGZvciAoXHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGluZGV4ID0gMDtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCA8IChzeW1ib2xUYWJsZVtzZWNvbmRQYXJhbV0/Lmxlbmd0aCA/PyAwKTtcclxuICAgICAgICAgICAgICAgICAgICBpbmRleCsrXHJcbiAgICAgICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBlbGVtZW50ID1cclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ltYm9sVGFibGVbc2Vjb25kUGFyYW1dICE9IG51bGxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgID8gc3ltYm9sVGFibGVbc2Vjb25kUGFyYW1dIVtpbmRleF0gPz8gJydcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIDogJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHN1YmluZGV4ID0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3ViaW5kZXggPCAoZWxlbWVudD8ubGVuZ3RoID8/IDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBzdWJpbmRleCArPSAyXHJcbiAgICAgICAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50ZXIrKztcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ZXIgPT0gZmlyc3RQYXJhbSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjZXNzZWQueCA9IGVsZW1lbnRbc3ViaW5kZXggLSAxXSBhcyBudW1iZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhY2Nlc3NlZC55ID0gZWxlbWVudFtzdWJpbmRleF0gYXMgbnVtYmVyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3ltYm9sVGFibGVbcmVzdWx0TmFtZV0gPSBhY2Nlc3NlZDtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhY2Nlc3NlZDtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgcG9pbnRfdG9fdmFyOiBmdW5jdGlvbiAoXHJcbiAgICAgICAgICAgICAgICBmaXJzdFBhcmFtOiBzdHJpbmcgfCBudW1iZXIsXHJcbiAgICAgICAgICAgICAgICBzZWNvbmRQYXJhbTogYW55LFxyXG4gICAgICAgICAgICAgICAgcmVzdWx0TmFtZTogeyBbeDogc3RyaW5nXTogc3RyaW5nIHwgbnVtYmVyIH1cclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB0b1ZhciA9IHN5bWJvbFRhYmxlW2ZpcnN0UGFyYW1dO1xyXG4gICAgICAgICAgICAgICAgc3ltYm9sVGFibGVbcmVzdWx0TmFtZVsneCddXSA9IHRvVmFyLng7XHJcbiAgICAgICAgICAgICAgICBzeW1ib2xUYWJsZVtyZXN1bHROYW1lWyd5J11dID0gdG9WYXIueTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgYWRkOiBmdW5jdGlvbiAoXHJcbiAgICAgICAgICAgICAgICBmaXJzdFBhcmFtOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBzZWNvbmRQYXJhbTogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgcmVzdWx0TmFtZTogc3RyaW5nIHwgbnVtYmVyXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVfMSA9IGdldFBhcmFtVmFsdWUoZmlyc3RQYXJhbSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZV8yID0gZ2V0UGFyYW1WYWx1ZShzZWNvbmRQYXJhbSk7XHJcbiAgICAgICAgICAgICAgICBzeW1ib2xUYWJsZVtyZXN1bHROYW1lXSA9IHZhbHVlXzEgKyB2YWx1ZV8yO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN5bWJvbFRhYmxlW3Jlc3VsdE5hbWVdO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzdWI6IGZ1bmN0aW9uIChcclxuICAgICAgICAgICAgICAgIGZpcnN0UGFyYW06IHN0cmluZyxcclxuICAgICAgICAgICAgICAgIHNlY29uZFBhcmFtOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICByZXN1bHROYW1lOiBzdHJpbmcgfCBudW1iZXJcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZV8xID0gcGFyc2VGbG9hdChnZXRQYXJhbVZhbHVlKGZpcnN0UGFyYW0pKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlXzIgPSBwYXJzZUZsb2F0KGdldFBhcmFtVmFsdWUoc2Vjb25kUGFyYW0pKTtcclxuICAgICAgICAgICAgICAgIHN5bWJvbFRhYmxlW3Jlc3VsdE5hbWVdID0gdmFsdWVfMSAtIHZhbHVlXzI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ltYm9sVGFibGVbcmVzdWx0TmFtZV07XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGRpdjogZnVuY3Rpb24gKFxyXG4gICAgICAgICAgICAgICAgZmlyc3RQYXJhbTogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgc2Vjb25kUGFyYW06IHN0cmluZyxcclxuICAgICAgICAgICAgICAgIHJlc3VsdE5hbWU6IHN0cmluZyB8IG51bWJlclxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlXzEgPSBwYXJzZUZsb2F0KGdldFBhcmFtVmFsdWUoZmlyc3RQYXJhbSkpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVfMiA9IHBhcnNlRmxvYXQoZ2V0UGFyYW1WYWx1ZShzZWNvbmRQYXJhbSkpO1xyXG4gICAgICAgICAgICAgICAgc3ltYm9sVGFibGVbcmVzdWx0TmFtZV0gPSB2YWx1ZV8xIC8gdmFsdWVfMjtcclxuICAgICAgICAgICAgICAgIHJldHVybiBzeW1ib2xUYWJsZVtyZXN1bHROYW1lXTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgbXVsOiBmdW5jdGlvbiAoXHJcbiAgICAgICAgICAgICAgICBmaXJzdFBhcmFtOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICBzZWNvbmRQYXJhbTogc3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgcmVzdWx0TmFtZTogc3RyaW5nIHwgbnVtYmVyXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWVfMSA9IHBhcnNlRmxvYXQoZ2V0UGFyYW1WYWx1ZShmaXJzdFBhcmFtKSk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZV8yID0gcGFyc2VGbG9hdChnZXRQYXJhbVZhbHVlKHNlY29uZFBhcmFtKSk7XHJcbiAgICAgICAgICAgICAgICBzeW1ib2xUYWJsZVtyZXN1bHROYW1lXSA9IHZhbHVlXzEgKiB2YWx1ZV8yO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHN5bWJvbFRhYmxlW3Jlc3VsdE5hbWVdO1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBtb2Q6IGZ1bmN0aW9uIChcclxuICAgICAgICAgICAgICAgIGZpcnN0UGFyYW06IHN0cmluZyxcclxuICAgICAgICAgICAgICAgIHNlY29uZFBhcmFtOiBzdHJpbmcsXHJcbiAgICAgICAgICAgICAgICByZXN1bHROYW1lOiBzdHJpbmcgfCBudW1iZXJcclxuICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZV8xID0gcGFyc2VGbG9hdChnZXRQYXJhbVZhbHVlKGZpcnN0UGFyYW0pKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlXzIgPSBwYXJzZUZsb2F0KGdldFBhcmFtVmFsdWUoc2Vjb25kUGFyYW0pKTtcclxuICAgICAgICAgICAgICAgIHN5bWJvbFRhYmxlW3Jlc3VsdE5hbWVdID0gdmFsdWVfMSAlIHZhbHVlXzI7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ltYm9sVGFibGVbcmVzdWx0TmFtZV07XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGF2ZXJhZ2U6IGZ1bmN0aW9uIChcclxuICAgICAgICAgICAgICAgIGZpcnN0UGFyYW06IHN0cmluZyB8IGFueVtdLFxyXG4gICAgICAgICAgICAgICAgc2Vjb25kUGFyYW06IGFueSxcclxuICAgICAgICAgICAgICAgIHJlc3VsdE5hbWU6IHN0cmluZyB8IG51bWJlclxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIGxldCBhdmVyYWdlID0gMDtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHRvdGFsID0gZmlyc3RQYXJhbS5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpbmRleCA9IDA7IGluZGV4IDwgZmlyc3RQYXJhbS5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgICAgICAgICBhdmVyYWdlICs9IGZpcnN0UGFyYW1baW5kZXhdO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgc3ltYm9sVGFibGVbcmVzdWx0TmFtZV0gPSBhdmVyYWdlIC8gdG90YWw7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gc3ltYm9sVGFibGVbcmVzdWx0TmFtZV07XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHJldHVybjogZnVuY3Rpb24gKFxyXG4gICAgICAgICAgICAgICAgZmlyc3RQYXJhbTogc3RyaW5nIHwgbnVtYmVyLFxyXG4gICAgICAgICAgICAgICAgc2Vjb25kUGFyYW06IHN0cmluZyB8IG51bWJlcixcclxuICAgICAgICAgICAgICAgIHJlc3VsdE5hbWU6IGFueVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHtcclxuICAgICAgICAgICAgICAgICAgICB4OiBwYXJzZUZsb2F0KHN5bWJvbFRhYmxlW2ZpcnN0UGFyYW1dIGFzIHN0cmluZyksXHJcbiAgICAgICAgICAgICAgICAgICAgeTogcGFyc2VGbG9hdChzeW1ib2xUYWJsZVtzZWNvbmRQYXJhbV0gYXMgc3RyaW5nKSxcclxuICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICBsYW5kbWFya3NDb250cm9sbGVyLnNldExhbmRtYXJrKFxyXG4gICAgICAgICAgICAgICAgICAgIGhlbHBWYXJpYWJsZXMubGFuZG1hcmtOYW1lLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdFxyXG4gICAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICAgIGxhbmRtYXJrc0NvbnRyb2xsZXIucmVkcmF3TGFuZG1hcmtzKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH07XHJcbiAgICB9XHJcblxyXG4gICAgZ2VuZXJhdGVCdXR0b25FdmVudCgpOiB2b2lkIHtcclxuICAgICAgICBjb25zdCBzZWxmID0gdGhpcztcclxuICAgICAgICBjb25zdCBzZW1pYXV0b21hdGljQnV0dG9uID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXHJcbiAgICAgICAgICAgICdzZW1pYXV0b21hdGljX2J1dHRvbidcclxuICAgICAgICApIGFzIEhUTUxCdXR0b25FbGVtZW50O1xyXG4gICAgICAgIGlmIChzZW1pYXV0b21hdGljQnV0dG9uKSB7XHJcbiAgICAgICAgICAgIHNlbWlhdXRvbWF0aWNCdXR0b24ub25jbGljayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHNlbGYuc3RhcnQuY2FsbChzZWxmKTtcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBTdGFydCBhbGwgcm91dGluZXNcclxuICAgICAqL1xyXG4gICAgc3RhcnQoKTogYm9vbGVhbiB7XHJcbiAgICAgICAgZm9yIChsZXQgaW5kZXggPSAwOyBpbmRleCA8IHRoaXMucm91dGluZXNEZXNjcmlwdGlvbi5sZW5ndGg7IGluZGV4KyspIHtcclxuICAgICAgICAgICAgY29uc3QgY3VycmVudFJvdXRpbmUgPSB0aGlzLnJvdXRpbmVzRGVzY3JpcHRpb25baW5kZXhdO1xyXG4gICAgICAgICAgICB0aGlzLmhlbHBWYXJpYWJsZXMubGFuZG1hcmtOYW1lID0gY3VycmVudFJvdXRpbmUubGFuZG1hcms7XHJcbiAgICAgICAgICAgIHRoaXMuaGVscFZhcmlhYmxlcy5hY2Nlc3NlZF9jdXJ2ZXMgPSBjdXJyZW50Um91dGluZS5hY2Nlc3NlZF9jdXJ2ZXM7XHJcbiAgICAgICAgICAgIGZvciAoXHJcbiAgICAgICAgICAgICAgICBsZXQgcG9zaXRpb24gPSAwO1xyXG4gICAgICAgICAgICAgICAgcG9zaXRpb24gPCBjdXJyZW50Um91dGluZS5yb3V0aW5lcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBwb3NpdGlvbisrXHJcbiAgICAgICAgICAgICkge1xyXG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGN1cnJlbnRSb3V0aW5lLnJvdXRpbmVzW3Bvc2l0aW9uXTtcclxuICAgICAgICAgICAgICAgIHRoaXMucHJlRnVuY3Rpb25zW2VsZW1lbnRbMF1dKFxyXG4gICAgICAgICAgICAgICAgICAgIGVsZW1lbnRbMV0sXHJcbiAgICAgICAgICAgICAgICAgICAgZWxlbWVudFsyXSxcclxuICAgICAgICAgICAgICAgICAgICBlbGVtZW50WzNdXHJcbiAgICAgICAgICAgICAgICApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0cnVlO1xyXG4gICAgfVxyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBTZW1pYXV0b21hdGljTGFuZG1hcmtzO1xyXG4iXX0=